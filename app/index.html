<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://kit.fontawesome.com/dafd3ebce7.js"
      crossorigin="anonymous"
    ></script>
    <title>COVID-19 MODEL</title>
  </head>

  <body id="mainPage">
    <div class="headerMenu">
      <div class="headerElement l" style="background-color: #bbb;">
        <span
          style="font-size: 50px; cursor: pointer; color: white;"
          onclick="openNav()"
          >&#9776;
        </span>
      </div>
      <div class="headerElement r" style="background-color: #aaa;">
        <h1>COVID-19 AGENT-BASED SIMULATION MODEL</h1>
      </div>
    </div>

    <div id="myNav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
        >&times;</a
      >
      <div id="sliderDIV">
        <div class="tooltipR-PM" id="PMDIV">
          <h2>Parameters</h2>
          <span class="tooltiptextR-PM"
            >Click on the categories below and move sliders to adjust respective
            values.</span
          >
        </div>

        <button class="accordion">Interaction Parameters</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Social Distancing:</p>
              <span class="tooltiptextR-PM" id="t8"
                >Extent to which agents repel other agents-being socially
                distant</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="100"
              value="0"
              step="0.05"
              class="slider"
              id="repulsionForce"
            />
            <div class="outputContainer">
              <output id="repulsionForceOut" for="repulsionForce">0</output>
            </div>
            <!-- <input type="number" id="initSusceptibleCount" name="initSusceptibleCount" min="100" max="500" value="100"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Attraction:</p>
              <span class="tooltiptextR-PM" id="t9"
                >Extent to which agents are attracted to community center.</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="100"
              value="0"
              step="0.05"
              class="slider"
              id="attractionForce"
            />
            <div class="outputContainer">
              <output id="attractionForceOut" for="attractionForce">
                0
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability of testing positive:</p>
              <span class="tooltiptextR-PM" id="t11"
                >Probability infectious agents show symptoms and get tested
                positive</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="1"
              value="0.5"
              step="0.05"
              class="slider"
              id="testedPositiveProb"
            />
            <div class="outputContainer">
              <output id="testedPositiveProbOut" for="testedPositiveProb">
                0.5
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Infectivity reduction factor:</p>
              <span class="tooltiptextR-PM" id="t12"
                >Reduces infectivity of a positive tested agent</span
              >
            </div>

            <input
              type="range"
              min="1"
              max="10"
              value="3"
              step="0.5"
              class="slider"
              id="InfectionRadiusRedFactor"
            />
            <div class="outputContainer">
              <output
                id="InfectionRadiusRedFactorOut"
                for="InfectionRadiusRedFactor"
              >
                3
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability of moving to ICU:</p>
              <span class="tooltiptextR-PM" id="t13"
                >Fraction of infected with critical condition</span
              >
            </div>

            <input
              type="range"
              min="0"
              max="1"
              value="0.1"
              step="0.05"
              class="slider"
              id="IcuProb"
            />
            <div class="outputContainer">
              <output id="IcuProbOut" for="icuProb">
                0.1
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">ICU capacity per community</p>
              <span class="tooltiptextR-PM" id="t14"
                >Number of ICU beds available per community</span
              >
            </div>
            <input
              type="range"
              min="0"
              max="20"
              value="5"
              step="1"
              class="slider"
              id="IcuCapacity"
            />
            <div class="outputContainer">
              <output id="IcuCapacityOut" for="IcuCapacity">
                5
              </output>
            </div>
          </div>
        </div>

        <button class="accordion">Agent Parameters</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Probability a collision will result in infection</p>
              <span class="tooltiptextR-PM" id="t15"
                >After contact with an infectious-chance you will get the
                disease</span
              >
            </div>
            <input
              type="range"
              min="0.00"
              max="1.00"
              step="0.05"
              value="0.90"
              class="slider"
              id="transmissionProb"
            />
            <div class="outputContainer">
              <output id="transmissionProbOut" for="transmissionProb"
                >90%
              </output>
            </div>
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">
                Probability a non-infectious agent becomes immune
              </p>
              <span class="tooltiptextR-PM" id="t16">
                Probability a non-infectious agent becomes directly immune post
                incubation</span
              >
            </div>
            <input
              type="range"
              min="0.00"
              max="1.00"
              step="0.05"
              value="0.1"
              class="slider"
              id="nonInToImmuneProb"
            />
            <div class="outputContainer">
              <output id="nonInToImmuneProbOut" for="nonInToImmuneProb"
                >10%</output
              >
            </div>
          </div>
          <!-- <div class="col-sm">
            <p>Size of agents</p>
            <input
              type="range"
              min="0"
              max="10"
              value="1.5"
              step="0.1"
              class="slider"
              id="agentRadius"
            />
            <div class="outputContainer">
              <output id="agentRadiusOut" for="agentRadius">2</output>
            </div>
          </div> -->

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum incubation time</p>
                <span class="tooltiptextR-PM" id="t17"
                  >The time it takes for an agent to start infecting others
                  after infection</span
                >
              </div>
              <input
                type="range"
                min="1"
                max="7"
                value="7"
                step="1"
                class="slider"
                id="minIncubationTime"
              />
              <div class="outputContainer">
                <output id="minIncubationTimeOut" for="minIncubationTime"
                  >7 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maxmimum incubation time</p>
                <span class="tooltiptextR-PM" id="t18"
                  >The max. time it takes for an agent to start infecting others
                  after infection</span
                >
              </div>
              <input
                type="range"
                min="8"
                max="14"
                value="14"
                step="1"
                class="slider"
                id="maxIncubationTime"
              />
              <div class="outputContainer">
                <output id="maxIncubationTimeOut" for="maxIncubationTime"
                  >14 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum time a patient is infectious</p>
                <span class="tooltiptextR-PM" id="t19"
                  >The min. time for which infectious agents infect others</span
                >
              </div>
              <p>
                <input
                  type="range"
                  min="1"
                  max="6"
                  value="5"
                  step="1"
                  class="slider"
                  id="minInfectiousTime"
                />
              </p>

              <div class="outputContainer">
                <output id="minInfectiousTimeOut" for="minInfectiousTime"
                  >5 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maximum time a patient is infectious</p>
                <span class="tooltiptextR-PM" id="t20"
                  >The max. time for which infectious agents infect others</span
                >
              </div>
              <input
                type="range"
                min="7"
                max="11"
                value="10"
                step="1"
                class="slider"
                id="maxInfectiousTime"
              />
              <div class="outputContainer">
                <output id="maxInfectiousTimeOut" for="maxInfectiousTime"
                  >10 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Minimum time from end of incubation to death.</p>
                <span class="tooltiptextR-PM" id="t21"
                  >The min. time needed for an agent to die after they turn
                  infectious</span
                >
              </div>
              <input
                type="range"
                min="1"
                max="16"
                value="15"
                step="1"
                class="slider"
                id="minTimeUntilDead"
              />
              <div class="outputContainer">
                <output id="minTimeUntilDeadOut" for="minTimeUntilDead"
                  >15 days</output
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="tooltipR-PM" id="PMDIV">
                <p class="tp">Maximum time from end of incubation to death.</p>
                <span class="tooltiptextR-PM" id="t22"
                  >The max. time until an agent dies after they turn
                  infectious</span
                >
              </div>
              <input
                type="range"
                min="17"
                max="35"
                value="30"
                step="1"
                class="slider"
                id="maxTimeUntilDead"
              />
              <div class="outputContainer">
                <output id="maxTimeUntilDeadOut" for="maxTimeUntilDead"
                  >30 days</output
                >
              </div>
            </div>
          </div>

          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">
                Circle of infection (how many people one person can infect at
                once)
              </p>
              <span class="tooltiptextR-PM" id="t23"
                >From how far an agent can infect someone</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="20"
              value="2"
              class="slider"
              id="infectionCircleRadius"
            />
            <div class="outputContainer">
              <output id="infectionRadiusOut" for="infectionCircleRadius"
                >5</output
              >
            </div>
          </div>
        </div>

        <button class="accordion">Initial Model Setup</button>
        <div class="panel">
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Initial number of susceptibles:</p>
              <span class="tooltiptextR-PM" id="t24"
                >How many non infectious agents the model starts with(reload
                after altering)</span
              >
            </div>
            <input
              type="range"
              min="100"
              max="10000"
              value="100"
              step="20"
              class="slider"
              id="initSusceptible"
            />
            <div class="outputContainer">
              <output id="initSusceptibleCount" for="initSusceptible"
                >50</output
              >
            </div>
            <!-- <input type="number" id="initSusceptibleCount" name="initSusceptibleCount" min="100" max="500" value="100"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Initial number of infectious:</p>
              <span class="tooltiptextR-PM" id="t25"
                >How many infectious agents the model starts with(reload after
                altering)</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="200"
              value="1"
              step="5"
              class="slider"
              id="initInfectious"
            />
            <div class="outputContainer">
              <output id="initInfectiousCount" for="initInfectious">3</output>
            </div>
            <!-- <input type="number" id="initSymptomaticCount" name="initSymptomaticCount" min="1" max="20" value="1"> -->
          </div>
          <div class="col-sm">
            <div class="tooltipR-PM" id="PMDIV">
              <p class="tp">Number of communities:</p>
              <span class="tooltiptextR-PM" id="t26"
                >How many communities there are in the model(reload after
                altering)</span
              >
            </div>
            <input
              type="range"
              min="1"
              max="12"
              step="1"
              class="slider"
              id="numCommunities"
            />
            <div class="outputContainer">
              <output id="numCommunitiesOut" for="numCommunities">4</output>
            </div>
          </div>
        </div>

        <button class="accordion">Presets</button>
        <div class="panel">
          <div class="preset-panel">
            <div class="custom-select" style="width: 250px;">
              <select id="preset-list"> </select>
            </div>

            <div class="button-div">
              <button type="button" id="select" class="btn btn-preset">
                Select
              </button>
            </div>
          </div>
        </div>

        <button class="accordion">Add a time-based rule</button>
        <div class="panel">
          <div id="timeline-form">
            <div id="timeline-simple-form">
              <div id="dropdown-simple-form">
                <select id="timelineform-simple-target">
                  <option value="soc">Social distancing</option>
                  <option value="atc">Attraction to the center</option>
                </select>
              </div>

              <div class="slider-container">
                <div class="slider-title">Time rule is active</div>
                <div class="new-slider" id="timelineTimeSlider"></div>
              </div>

              <div class="slider-container">
                <div class="slider-title">Value</div>
                <div class="new-slider" id="timelineTimeValueSlider"></div>
              </div>

              <button id="timeline-add-simple-rule">+</button>
            </div>
          </div>
        </div>

        <button class="accordion">Add a threshold-based rule</button>
        <div class="panel">
          <div id="timeline-form">
            <div id="timeline-threshold-form">
              <select id="timelineform-threshold-target">
                <option value="soc">Social distancing</option>
                <option value="atc">Attraction to the center</option>
              </select>
              <select id="timelineform-threshold-param">
                <option value="inf">Infected people</option>
                <option value="icu">ICU </option>
              </select>
              <label for="timelineform-threshold-trigger">Trigger: </label>
              <input type="text" id="timelineform-threshold-trigger" />

              <div class="slider-container">
                <div class="slider-title">Value</div>
                <div class="new-slider" id="timelineform-threshold-value"></div>
              </div>

              <button id="timeline-add-threshold-rule">+</button>
            </div>
          </div>
        </div>

        <button class="accordion">Rules list</button>
        <div class="panel">
          <div id="rulesDIV"></div>
        </div>

        <div class="row p-3">
          <button type="button" id="reload" class="btn btn-secondary">
            Reload
          </button>
          <button class="btn btn-secondary" id="download">Download Data</button>
        </div>
      </div>
    </div>

    <script>
      function openNav() {
        document.getElementById('myNav').style.width = '45%';
      }

      function closeNav() {
        document.getElementById('myNav').style.width = '0%';
      }
    </script>

    <script>
      var acc = document.getElementsByClassName('accordion');
      var i;

      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener('click', function () {
          this.classList.toggle('active');
          var panel = this.nextElementSibling;
          if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
          } else {
            panel.style.maxHeight = panel.scrollHeight + 'px';
          }
        });
      }
    </script>

    <main id="main">
      <div id="left-panel">
        <div id="chart-container">
          <canvas id="chart-canvas" height="400px"></canvas>
        </div>
        <div id="time-control-bar">
          <button id="time-control-toggle-pause-button">
            <i class="fas fa-pause" style="font-size: 22px;"></i
            ><i class="fas fa-play" style="font-size: 19px;"></i>
          </button>
          <!-- <button id="time-control-reset-button" class="btn-secondary">
            Reset
          </button> -->
          <button id="time-control-reset-button">
            <i class="fas fa-undo" style="font-size: 22px;"></i>
          </button>
          <span id="time-control-days-display"></span>
        </div>
        <div id="demographics-container">
          <canvas id="demographics" height="500px"></canvas>
          <div class="tooltip-demo" id="t10">
            About
            <span class="tooltiptext-demo">
              Demography is the statistical study of populations, especially
              human beings.The chart above displays information regarding the
              current running simulation concerning the infection of males(left)
              and females(right) of different age ranges. The age ranges are on
              the y axis and the values of the corresponding
              statistic(infectious,immune etc.) are on the x-axis. This graph
              shows the spread of diesease across different age group and shows
              that young people are also less likely to die than older people in
              general.
            </span>
          </div>
        </div>
      </div>
      <div id="right-side-container">
        <div id="model-border-canvases-container">
          <canvas id="glCanvas" width="600px" height="600px"></canvas>
          <!-- This canvas is used for drawing a border around each community so must have same witdth and height.it is overlapped with the main agent canvas-->
          <canvas id="BorderCanvas" width="600px" height="600px"></canvas>
          <div class="tooltipB" id="t6">
            About
            <span class="tooltiptextB">
              The model shown above is a graphical representation of our Agent
              Based simulation. The dots represent agents which reflect the
              behaviour of people in real life. They have characteristics like
              "social distancing" and "attraction to centre" which you can
              change to alter the respective behaviour of the agents. Every
              agent has a color which is an indication of their current "state"
              with respect to their infectiousness.The states are as follows
              Blue-Susceptible, Yellow-Non Infectious, Red-Infectious,
              Grey-Immune, Black- Dead All agents reside in
              communities,seperated using white borders-which model real life
              cities and agents can relocate between different communities which
              can be seen as agents jumping from one community to another. The
              model corresponds exactly with the graph on the top left.
            </span>
          </div>
        </div>
        <div class="statrow">
          <div class="stat" style="background-color: #05befc;">
            <h3>Susceptible</h3>
            <p id="s1"></p>
          </div>
          <div class="stat" style="background-color: #c9e265;">
            <h3>Non-Infectious</h3>
            <p id="s2"></p>
          </div>
          <div class="stat" style="background-color: #fd7e65;">
            <h3>Infectious</h3>
            <p id="s3"></p>
          </div>
          <div class="stat" style="background-color: #a6a6a6;">
            <h3>Immune</h3>
            <p id="s4"></p>
          </div>
          <div class="stat" style="background-color: #000000;">
            <h3>Dead</h3>
            <p id="s5"></p>
          </div>
          <div class="stat" id="icuDIV" style="background-color: green;">
            <h3>In ICU</h3>
            <p id="s6"></p>
          </div>
        </div>
        <div id="timeline">
          <div>
            <canvas id="timeline-element" width="600" height="50%">
              Days: 0
            </canvas>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
